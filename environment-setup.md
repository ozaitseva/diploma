##Исходные данные: 
* основная операционная система Ubuntu 14.04 Desktop AMD64

В настоящее время в Ubuntu официально поддерживается только гипервизор Qemu-KVM. Этот гипервизор является частью кода ядра операционной системы Linux. 
Для того, чтобы его использовать, ваш процессор должен поддерживать технологию виртуализации. Проверить данную информацию можно, выполнив команду в терминале:

**kvm –ok**

В качестве основной операционной системы рекомендуется использовать 64-битную операционную систему, чтобы в дальнейшем можно было:

* Устанавливать 64-битные гостевые операционные системы
* Выделять гостевым системам более 2 Гбайт оперативной памяти

Установка гипервизора Qemu-KVM:

В терминале необходимо ввести следующую команду: 

**sudo apt-get install qemu-kvm libvirt-bin ubuntu-vm-builder bridge-utils**
Помимо Qemu-KVM будут установлены пакет Ubuntu VM builder, а также библиотека Libvirt, которые необходимы для удобного управления гипервизором.
 
Эта установка не включает в себя графической интерфейс, но в случае необходимости его можно установить с помощью команды:

**sudo apt-get install virt-manager** 

##Создание гостевой системы: 

Сначала необходимо создать файл-образ в качестве жесткого диска. Можно создать новый файл с сырыми данными – в формате raw, однако это не единственный доступный формат
файлов, наиболее современным и удобным является формат qcow2, который поддерживает снапшоты, шифрование и сжатие. При создании также необходимо указать объем жесткого диска. 

**qemu-system-x86_64 create -f qcow2 win7.img 15G**

Далее необходимо запустить ISO-образ гостевой операционной системы. Я выбрала операционную систему Windows 7 Professional x64.

**qemu-system-x86_64 -cpu Nehalem -enable-kvm –hda ./win7.img -cdrom ./Windows7_Professional_x64.iso -boot d -m 2048**
* -cpu – опция, отвечающая за эмуляцию командных инструкций различных процессоров. Nehalem – это кодовое название процессора  Intel Core i7 9xx. Весь список поддерживаемых  процессоров можно узнать, воспользовавшись командой: qemu-system-x86_64 -cpu ?
* -enable-kvm  -  включает поддержку kvm ядра
* -hda ./win7.img – описывает используемый файл-образ, создание которого описано выше
* -cdrom ./ Windows7_Professional_x64.iso -  указывает на ISO-образ, который мы будем использовать, виртуально находящейся на устройстве cdrom
*-boot d  -  указывает на тот факт, что загрузка будет с указанного выше ISO-образа , буква «d» говорит о том, что ISO образ находится не в приводе cdrom, а на жестком диске
* -m 2048  - объем выделяемой оперативной памяти.

Затем нужно проинсталировать систему и приступать к использованию виртуальной системы. 

##Запуск виртуальной операционной системы в Qemu:

Для запуска необходимо воспользоваться командой: 

**qemu-system-x86_64 -cpu Nehalem -enable-kvm –hda ./win7.img -m 2048**

##Снятие образа физической памяти: 
Для создания образа физической памяти воспользуемся командой из пакета qemu-system: 

Запускаем гостевую операционную систему и Qemu Console с помощью команды: 

**qemu-system-x86_64 -cpu Nehalem -enable-kvm –hda ./win7.img –monitor stdio -m 2048**

Сохраняем физическую память (максимальный размер одного дампа составляет 4Гб): 

**pmemsave <start address> <length> <filename>**

Объем оперативной памяти нашей виртуальной машины составляет 2 Гб, чтобы снять образ 2Гб оперативной памяти в терминале вводим следующую команду: 

**pmemsave 0 0x80000000 win7.dump**

##Создание снапшота диска: 

Сделать снапшот диска можно с помощью библиотеки Libvirt:

**virsh snapshot-create-as vm_name snapshot_name "snapshot1 description" --disk-only –atomic**

Для того, чтобы посмотреть список снапшотов интересующей виртуальной машины можно воспользоваться командой: 

**virsh snapshot-list vm_name**







